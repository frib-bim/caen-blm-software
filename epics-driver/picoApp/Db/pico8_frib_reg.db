##  Added by Scott
## ==================================================
record(stringin, "$(CTRL)ioc_version") {
  field(PINI, "YES")
  field(VAL, "vBC02 (2018-Feb)")
}

record(longin, "$(FPS)FPSSTS_RD") {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x3005c")  field(SCAN, ".5 second") field(FLNK, "$(FPS)FPSSTS_Fout_")}
record(longin, "$(CTRL)EVRSTS_RD") {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x30058")  field(SCAN, ".5 second") }
record(longin, "$(CTRL)CYCCNT_RD") {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x30058 mask=0x0000ffff")  field(SCAN, ".5 second") }
record(longin, "$(CTRL)PLSCNT_RD") {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x30058 mask=0xffff0000")  field(SCAN, ".5 second") }

## DDR Interface
record(longin, "$(CTRL)DDR_STS_RD")     {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x30004") field(SCAN, ".2 second") }
record(longin, "$(CTRL)DDR_STS2_RD")    {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x30004 mask=0xffff0000") field(SCAN, ".2 second") }
record(longin, "$(CTRL)DDR_CTRL_RD")    {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x30008") field(SCAN, ".2 second") }
record(longin, "$(CTRL)DDR_PATTERN_RD") {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x3000C") field(SCAN, ".2 second") }
record(longin, "$(CTRL)DDR_LAST_ADDR")  {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x30010") field(SCAN, ".2 second") }
record(longout,"$(CTRL)DDR_CTRL")       {  field(DTYP, "Pico8 User Reg UInt32")  field(OUT , "@$(NAME) offset=0x30008")  field(PINI, "YES")  info(autosaveFields_pass0, "VAL") }
record(longout,"$(CTRL)DDR_PATTERN")    {  field(DTYP, "Pico8 User Reg UInt32")  field(OUT , "@$(NAME) offset=0x3000C")  field(PINI, "YES")  info(autosaveFields_pass0, "VAL") }


## Python DDR readback interface
record(longout, "$(CTRL)acqDDRwave") { field(DTYP, "Soft Channel") field(VAL,"0")  field(PINI, "YES") }
record(longout, "$(CTRL)acqDDRnpts") { field(DTYP, "Soft Channel") field(VAL,"20000")  field(PINI, "YES") }
record(ao,      "$(CTRL)DDR_TIME_RD") { field(DTYP, "Soft Channel") field(VAL,"0")  field(PINI, "YES") }
record(waveform, "$(CTRL)DDR_NOKW_RD") {  field(DTYP, "Soft Channel")  field(FTVL, "SHORT")  field(NELM, "1048576") }
record(waveform, "$(CTRL)DDR_BEAMSTATW_RD") {  field(DTYP, "Soft Channel")  field(FTVL, "SHORT")  field(NELM, "1048576") }


## CYCLE debug (should probably comment out to not interfere?)
record(longin, "$(CTRL)CYC_TSEC") {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x30100") field(SCAN, ".1 second") }
record(longin, "$(CTRL)CYC_TSUB") {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x30104") field(SCAN, ".1 second") }
record(longin, "$(CTRL)CYC_TON")  {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x30108") field(SCAN, ".1 second") }
record(longin, "$(CTRL)CYC_EOCM") {  field(DTYP, "Pico8 User Reg UInt32")  field(INP , "@$(NAME) offset=0x3010C") field(SCAN, ".1 second") }
record(calc, "$(CTRL)IRQT_MSEC") {  field(INPA, "$(CTRL)IRQT_RD NPP MS")  field(CALC, "A/125.0e3")  field(EGU , "ms") }
record(calc, "$(CTRL)ISRT_MSEC") {  field(INPA, "$(CTRL)ISRT_RD NPP MS")  field(CALC, "A/125.0e3")  field(EGU , "ms") }
record(calc, "$(CTRL)ISRMAX_MSEC") {  field(INPA, "$(CTRL)ISRMAX_RD NPP MS")  field(CALC, "A/125.0e3")  field(EGU , "ms") }



##  Original from Davidsaver
## ==================================================

record(bi, "$(CTRL)CAPVLD_RSTS") {
    field(DTYP, "Pico8 Capture Valid")
    field(INP , "@$(NAME)")
    field(SCAN, "I/O Intr")
    field(ZNAM, "INVALID")
    field(ONAM, "OK")
    field(ZSV , "MAJOR")
}

record(longin, "$(CTRL)CAPCNT_RD") {
    field(DTYP, "Pico8 Capture Updates")
    field(INP , "@$(NAME)")
    field(SCAN, "I/O Intr")
}

record(waveform, "$(CTRL)CAPMSG_RD") {
    field(DTYP, "Pico8 Capture Message")
    field(INP , "@$(NAME)")
    field(SCAN, "I/O Intr")
    field(FTVL, "CHAR")
    field(NELM, "256")
    field(PINI, "YES")
}

record(waveform, "$(CTRL)CAPMSGLOG_RD") {
    field(DTYP, "Pico8 Capture Message Log")
    field(INP , "@$(NAME)")
    field(SCAN, "I/O Intr")
    field(FTVL, "CHAR")
    field(NELM, "4096")
    field(PINI, "YES")
}

record(longin, "$(CTRL)FFWVER_RD") {
    field(DESC, "FRIB firmware version")
    field(DTYP, "Pico8 User Reg UInt32")
    field(INP , "@$(NAME) offset=0x30040")
    field(PINI, "YES")
}

record(longin, "$(CTRL)IRQT_RD") {
    field(DESC, "Time between IRQs")
    field(DTYP, "Pico8 User Reg UInt32")
    field(INP , "@$(NAME) offset=0x30028")
    field(SCAN, ".1 second")
    field(FLNK, "$(CTRL)IRQT_MSEC")
}

record(longin, "$(CTRL)ISRT_RD") {
    field(DESC, "ISR time")
    field(DTYP, "Pico8 User Reg UInt32")
    field(INP , "@$(NAME) offset=0x3002c")
    field(SCAN, ".1 second")
    field(FLNK, "$(CTRL)ISRT_MSEC")
}

record(longin, "$(CTRL)ISRMAX_RD") {
    field(DESC, "ISR time")
    field(DTYP, "Pico8 User Reg UInt32")
    field(INP , "@$(NAME) offset=0x30030")
    field(SCAN, ".1 second")
    field(FLNK, "$(CTRL)ISRMAX_MSEC")
}

record(longout, "$(CTRL)ISRMAXCLR_CMD") {
    field(DESC, "ISR time")
    field(DTYP, "Pico8 User Reg UInt32")
    field(OUT , "@$(NAME) offset=0x30030")
    field(PINI, "YES")
    field(VAL , "0")
}

record(ao, "$(FPS)FRZDLY_CSET") {
    field(DESC, "Length of post trigger samples")
    field(DTYP, "Raw Soft Channel")
    field(OUT,  "$(FPS)CBUFPOST_CSET")
    field(EGU,  "ms")
    field(PINI, "YES")
    field(ASLO, "0.254")
    field(AOFF, "0")
    field(VAL,  "25")
    field(FLNK, "$(FPS)CBUFPOST_CSET")
    info(autosaveFields_pass0, "VAL")
}

record(longout, "$(FPS)CBUFPOST_CSET") {
    field(DESC, "# of post trigger samples")
    field(DTYP, "Pico8 User Reg UInt32")
    field(DOL,  "$(FPS)FRZDLY_CSET.RVAL")
    field(OUT , "@$(NAME) offset=0x30044 mask=0xff000000")
    field(PINI, "YES")
    info(autosaveFields_pass0, "VAL")
}

record(longout, "$(FPS)SLT_CSET") {
    field(DESC, "FPS Slot #")
    field(DTYP, "Pico8 User Reg UInt32")
    field(OUT , "@$(NAME) offset=0x30044 mask=0x000f0000")
    field(PINI, "YES")
    field(VAL , "$(SLOT=0)")
}

record(bo, "$(FPS)FRCTRP_CSET") {
    field(DESC, "Force FPS trip/NOK")
    field(DTYP, "Pico8 User Reg UInt32")
    field(OUT , "@$(NAME) offset=0x30044")
    field(MASK, "0x8000")
    field(ZNAM, "Idle")
    field(ONAM, "Trip")
    field(HIGH, "0.1")
    info(autosaveFields_pass0, "VAL")
}

record(bo, "$(FPS)CLR_CSET") {
    field(DESC, "Clear Trip/NOK")
    field(DTYP, "Pico8 User Reg UInt32")
    field(OUT , "@$(NAME) offset=0x30044")
    field(MASK, "0x4000")
    field(ZNAM, "Idle")
    field(ONAM, "Clear")
    field(HIGH, "0.1")
    info(autosaveFields_pass0, "RVAL")
}

record(bo, "$(FPS)FRZ_CSET") {
    field(DESC, "Force buffer freeze")
    field(DTYP, "Pico8 User Reg UInt32")
    field(OUT , "@$(NAME) offset=0x30044")
    field(MASK, "0x2000")
    field(ZNAM, "Idle")
    field(ONAM, "Freeze")
    field(HIGH, "0.1")
    info(autosaveFields_pass0, "RVAL")
}

record(bo, "$(FPS)THW_CSET") {
    field(DESC, "Unfreeze buffer")
    field(DTYP, "Pico8 User Reg UInt32")
    field(OUT , "@$(NAME) offset=0x30044")
    field(MASK, "0x1000")
    field(ZNAM, "Idle")
    field(ONAM, "Thaw")
    field(HIGH, "0.1")
    info(autosaveFields_pass0, "RVAL")
}

record(bo, "$(FPS)RST_CSET") {
    field(DESC, "Reset FRIB logic")
    field(DTYP, "Pico8 User Reg UInt32")
    field(OUT , "@$(NAME) offset=0x30044")
    field(MASK, "0x0800")
    field(ZNAM, "Idle")
    field(ONAM, "Reset")
    field(HIGH, "0.1")
    info(autosaveFields_pass0, "RVAL")
}

record(longout, "$(FPS)DTASEL_CSET") {
    field(DTYP, "Pico8 User Reg UInt32")
    field(OUT , "@$(NAME) offset=0x30048")
    info(autosaveFields_pass0, "VAL")
}

record(longin, "$(CTRL)COMOK_RD") {
    field(DESC, "# of EVR comm ok")
    field(DTYP, "Pico8 User Reg UInt32")
    field(INP , "@$(NAME) offset=0x3004c mask=0xffff0000")
    field(SCAN, "1 second")
    field(FLNK, "$(CTRL)COMAT_RD")
}

record(longin, "$(CTRL)COMAT_RD") {
    field(DESC, "# of EVR comm attempts")
    field(DTYP, "Pico8 User Reg UInt32")
    field(INP , "@$(NAME) offset=0x3004c mask=0x0000ffff")
    field(FLNK, "$(CTRL)COMDFF_RD")
}

record(calc, "$(CTRL)COMDFF_RD") {
    field(INPA, "$(CTRL)COMOK_RD NPP MS")
    field(INPB, "$(CTRL)COMAT_RD NPP MS")
    field(CALC, "A-B")
}

record(calc, "$(CTRL)COMERR_RD") {
    field(DESC, "Comm error rate")
    field(SCAN, "1 second")
    field(PHAS, "1")
    field(INPA, "$(CTRL)COMDFF_RD NPP MS")
    field(CALC, "C:=A-B;B:=A;C")
    field(EGU , "Hz")
    field(HIGH, "1")
    field(LOW , "-1")
    field(HSV , "MAJOR")
    field(LSV , "MAJOR")
}

record(stringin, "$(CTRL)TMECUR_RD") {
    field(DESC, "Current time from EVR")
    field(DTYP, "Pico8 User Reg Time64")
    # step= is really sub-sec counter frequency in Hz
    field(INP , "@$(NAME) offset=0x30050 step=80500000")
    field(SCAN, "1 second")
    field(TSE , "-2")
}

record(fanout, "$(FPS)FPSSTS_Fout_") {
    field(LNK1, "$(FPS)FRZ_RSTS")
    field(LNK2, "$(FPS)NOKLTH_RSTS")
    field(LNK3, "$(FPS)NOK_RSTS")
    field(LNK4, "$(FPS)PMT_RSTS")
    field(FLNK, "$(FPS)TMETRP_RD")
}

record(bi, "$(FPS)FRZ_RSTS") {
    field(DESC, "Circ buffer run")
    field(DTYP, "Pico8 User Reg UInt32")
    field(INP , "@$(NAME) offset=0x3005c")
    field(MASK, "0x8")
    field(ZNAM, "Run")
    field(ONAM, "Frozen")
}

record(bi, "$(FPS)NOKLTH_RSTS") {
    field(DESC, "FPS NOK Latch")
    field(DTYP, "Pico8 User Reg UInt32")
    field(INP , "@$(NAME) offset=0x3005c")
    field(MASK, "0x4")
    field(ZNAM, "OK")
    field(ONAM, "Trip")
}

record(bi, "$(FPS)NOK_RSTS") {
    field(DESC, "FPS NOK Current")
    field(DTYP, "Pico8 User Reg UInt32")
    field(INP , "@$(NAME) offset=0x3005c")
    field(MASK, "0x2")
    field(ZNAM, "OK")
    field(ONAM, "Trip")
}

record(bi, "$(FPS)PMT_RSTS") {
    field(DESC, "FPS Permit")
    field(DTYP, "Pico8 User Reg UInt32")
    field(INP , "@$(NAME) offset=0x3005c")
    field(MASK, "0x8")
    field(ZNAM, "Run")
    field(ONAM, "Frozen")
}

record(stringin, "$(FPS)TMETRP_RD") {
    field(DESC, "Trip time")
    field(DTYP, "Pico8 User Reg Time64")
    # step= is really sub-sec counter frequency in Hz
    field(INP , "@$(NAME) offset=0x30060 step=80500000")
    field(SCAN, "1 second")
    field(TSE , "-2")
    field(FLNK, "")
}

record(longin, "$(CTRL)GAIN0_RD") {
    field(DTYP, "Pico8 User Reg UInt32")
    field(INP , "@$(NAME) offset=0x100")
    field(PINI, "YES")
}
